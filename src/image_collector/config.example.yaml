# Example scheduler configuration for automatic Sentinel-2 image collection
#
# This file demonstrates all available configuration options for scheduling
# automatic satellite image downloads. Copy this file to 'config.yaml' and
# customize it for your needs.

# Global scheduler settings
max_concurrent_jobs: 1  # Maximum number of jobs to run simultaneously
job_coalesce: true  # Combine multiple missed runs into one
job_max_instances: 1  # Maximum instances of the same job running at once

# Collection jobs
jobs:
  # Weekly collection for coastal monitoring
  # Runs every Monday at 2 AM, collecting images from the past week
  - name: "coastal_weekly"
    enabled: true
    
    # Path to AOI GeoJSON file (supports ~ for home directory)
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/coastal_area.geojson"
    
    # Schedule configuration
    schedule:
      type: "weekly"
      day_of_week: "monday"  # Can be day name or number (0=Monday, 6=Sunday)
      time: "02:00"  # HH:MM format (24-hour)
    
    # Date range for product search
    date_range:
      type: "relative"  # Relative to execution time
      days: 7  # Search for products from the last 7 days
    
    # Product filtering criteria
    filters:
      max_cloud_cover: 20  # Maximum cloud cover percentage (0-100)
      min_aoi_coverage: 90  # Minimum AOI coverage percentage (0-100)
      product_level: "L2A"  # "L1C" or "L2A"
    
    # Automatic product selection strategy
    auto_select:
      strategy: "best_n"  # Select top N products by quality score
      max_products: 3  # Number of products to download (for "best_n")
      quality_threshold: 0.7  # Quality threshold (for "all_above_threshold")
      
      # Quality score weights (must sum to 1.0)
      aoi_coverage_weight: 0.4  # Weight for AOI coverage
      cloud_cover_weight: 0.4  # Weight for cloud cover
      recency_weight: 0.2  # Weight for date recency
    
    # Output directory for downloaded products
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Monthly collection for seasonal analysis
  # Runs on the 1st of each month at 3 AM, collecting images from the past 30 days
  - name: "seasonal_monthly"
    enabled: true
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/study_area.geojson"
    
    schedule:
      type: "monthly"
      day: 1  # Day of month (1-31)
      time: "03:00"
    
    date_range:
      type: "relative"
      days: 30  # Last 30 days
    
    filters:
      max_cloud_cover: 15
      min_aoi_coverage: 100  # Only products that fully cover the AOI
      product_level: "L2A"
    
    auto_select:
      strategy: "best_per_week"  # Select best product from each week
      aoi_coverage_weight: 0.5
      cloud_cover_weight: 0.3
      recency_weight: 0.2
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Yearly collection for long-term monitoring
  # Runs on January 1st at midnight, collecting images from the past year
  - name: "annual_archive"
    enabled: true
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/archive_area.geojson"
    
    schedule:
      type: "yearly"
      month: 1  # January (1-12)
      day: 1  # 1st day
      time: "00:00"
    
    date_range:
      type: "relative"
      days: 365  # Last year
    
    filters:
      max_cloud_cover: 10  # Stricter cloud cover for archival
      min_aoi_coverage: 95
      product_level: "L2A"
    
    auto_select:
      strategy: "all_above_threshold"  # Download all products meeting threshold
      quality_threshold: 0.8  # Higher threshold for archival quality
      aoi_coverage_weight: 0.5
      cloud_cover_weight: 0.4
      recency_weight: 0.1
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Custom cron schedule example
  # Runs every 3 days at 1 AM
  - name: "custom_interval"
    enabled: false  # Disabled by default
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/custom_area.geojson"
    
    schedule:
      type: "custom"
      cron: "0 1 */3 * *"  # Cron format: minute hour day month day_of_week
      # Cron examples:
      # "0 2 * * *"      - Every day at 2 AM
      # "30 4 1,15 * *"  - 1st and 15th of month at 4:30 AM
      # "0 */6 * * *"    - Every 6 hours
      # "0 0 * * 1,3,5"  - Every Monday, Wednesday, Friday at midnight
    
    date_range:
      type: "relative"
      days: 3
    
    filters:
      max_cloud_cover: 25
      min_aoi_coverage: 80
      product_level: "L2A"
    
    auto_select:
      strategy: "best_n"
      max_products: 2
      aoi_coverage_weight: 0.4
      cloud_cover_weight: 0.4
      recency_weight: 0.2
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Absolute date range example (for one-time or specific period collection)
  # This job will always search the same date range regardless of execution time
  - name: "specific_period"
    enabled: false  # Disabled by default
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/study_area.geojson"
    
    schedule:
      type: "monthly"
      day: 1
      time: "04:00"
    
    date_range:
      type: "absolute"
      start_date: "2024-01-01"  # YYYY-MM-DD format
      end_date: "2024-12-31"
    
    filters:
      max_cloud_cover: 20
      min_aoi_coverage: 90
      product_level: "L2A"
    
    auto_select:
      strategy: "best_per_week"
      aoi_coverage_weight: 0.4
      cloud_cover_weight: 0.4
      recency_weight: 0.2
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Coverage optimization example - Greedy heuristic
  # Fast near-optimal coverage for large areas
  - name: "coverage_greedy_example"
    enabled: false  # Disabled by default
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/large_area.geojson"
    
    schedule:
      type: "weekly"
      day_of_week: "tuesday"
      time: "01:00"
    
    date_range:
      type: "relative"
      days: 14  # Search last 2 weeks for better coverage
    
    filters:
      max_cloud_cover: 30  # Relaxed for coverage optimization
      min_aoi_coverage: 50  # Allow partial coverage images
      product_level: "L2A"
    
    auto_select:
      strategy: "coverage_greedy"  # Fast greedy heuristic
      min_coverage_fraction: 0.98  # Allow 2% uncovered area
      grid_spacing_meters: 100  # Moderate precision (50-200m recommended)
      
      # Coverage cost weights (must sum to 1.0)
      coverage_cloud_weight: 0.3  # Weight for cloud cover in cost function
      coverage_quality_weight: 0.7  # Weight for quality score in cost function
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Coverage optimization example - Optimal MILP solver
  # Globally optimal solution for small-medium areas
  - name: "coverage_optimal_example"
    enabled: false  # Disabled by default (requires OR-Tools)
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/coastal_area.geojson"
    
    schedule:
      type: "monthly"
      day: 15
      time: "02:00"
    
    date_range:
      type: "relative"
      days: 30
    
    filters:
      max_cloud_cover: 15  # Stricter filters reduce candidate pool
      min_aoi_coverage: 80
      product_level: "L2A"
    
    auto_select:
      strategy: "coverage_optimal"  # MILP-based optimal solution
      min_coverage_fraction: 1.0  # Require complete coverage
      grid_spacing_meters: 75  # Finer grid for precise coverage
      solver_timeout_seconds: 600  # 10 minute time limit
      
      coverage_cloud_weight: 0.3
      coverage_quality_weight: 0.7
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

  # Coverage optimization example - Hybrid approach
  # Combines coverage optimization with strict quality filters
  - name: "coverage_hybrid_example"
    enabled: false  # Disabled by default
    
    aoi_path: "~/SatShor/src/shoreline_extractor/data/json/study_area.geojson"
    
    schedule:
      type: "weekly"
      day_of_week: "friday"
      time: "03:00"
    
    date_range:
      type: "relative"
      days: 21  # Search 3 weeks for better candidate pool
    
    filters:
      max_cloud_cover: 10  # Very strict cloud cover
      min_aoi_coverage: 60  # Allow partial coverage for better optimization
      product_level: "L2A"
    
    auto_select:
      strategy: "coverage_greedy"  # Fast algorithm with strict pre-filtering
      min_coverage_fraction: 0.95  # Allow 5% tolerance for quality trade-off
      grid_spacing_meters: 150  # Coarser grid for faster processing
      
      coverage_cloud_weight: 0.4  # Higher weight on cloud cover
      coverage_quality_weight: 0.6
    
    output_dir: "~/SatShor/src/shoreline_extractor/data/img"

# Notes:
# - All paths support ~ for home directory expansion
# - Schedule times are in 24-hour format
# - Date ranges can be "relative" (X days before execution) or "absolute" (fixed dates)
# - Auto-selection strategies:
#   * "best_n": Download top N products by quality score
#   * "all_above_threshold": Download all products above quality threshold
#   * "best_per_week": Download best product from each week in date range
#   * "coverage_greedy": Fast greedy heuristic for near-optimal area coverage (large AOIs)
#   * "coverage_optimal": MILP-based globally optimal coverage (requires OR-Tools, best for small-medium AOIs)
# - Quality score is calculated from weighted combination of:
#   * AOI coverage (higher is better)
#   * Cloud cover (lower is better)
#   * Date recency (more recent is better)
# - Products are automatically deduplicated (won't download twice)
#
# Coverage Optimization Strategies:
# - Solve the geometric set cover problem to find minimal image set for complete area coverage
# - coverage_greedy: Fast heuristic, typically within 10-20% of optimal, suitable for large areas (>1000 km²)
# - coverage_optimal: Globally optimal solution using OR-Tools MILP solver, may be slow for >100 candidates
# - Coverage parameters:
#   * min_coverage_fraction: Target coverage (0.95-1.0), allows tolerance for uncovered gaps
#   * grid_spacing_meters: Sampling density (50-200m recommended, finer = more accurate but slower)
#   * solver_timeout_seconds: Time limit for MILP solver (default 300s, only for coverage_optimal)
#   * coverage_cloud_weight & coverage_quality_weight: Cost function weights (must sum to 1.0)
# - For very large AOIs (>5000 km²), consider partitioning into sub-regions or using coarser grid spacing
# - OR-Tools installation: pip install ortools>=9.14.0 (required for coverage_optimal strategy)
